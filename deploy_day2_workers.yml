---
- hosts: bastion
  roles:
    - role: create_day2_cluster
      when: groups['day2_workers'] | default([]) | length > 0

- hosts: bastion
  pre_tasks:
  roles:
    - role: generate_discovery_iso
      when: groups['day2_workers'] | default([]) | length > 0
  vars:
    secure: false
    ASSISTED_INSTALLER_HOST: "{{ hostvars['assisted_installer']['host'] }}"
    ASSISTED_INSTALLER_PORT: "{{ hostvars['assisted_installer']['port'] }}"
    DOWNLOAD_DEST_FILE: "{{ day2_discovery_iso_name }}"
    DOWNLOAD_DEST_PATH: "{{ iso_download_dest_path | default('/opt/http_store/data') }}"
    URL_ASSISTED_INSTALLER_CLUSTERS_DOWNLOAD_IMAGE: "{{ ASSISTED_INSTALLER_BASE_URL }}/clusters/{{ ADD_HOST_CLUSTER_ID }}/downloads/image"

- hosts: day2_workers
  gather_facts: false
  strategy: free
  roles:
    - add_day2_node

- hosts: bastion
  gather_facts: false
  roles:
    - role: approve_csrs
      when: groups['day2_workers'] | default([]) | length > 0
